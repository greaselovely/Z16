<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <title>NetScreen SSG 20 Dual WAN</title>
    <meta name="viewport" content="width=device-width"/>
    <meta http-equiv="X-UA-Compatible" content="chrome=1"/>
    
    <!-- Use relative_url filter so paths work in GitHub Pages -->
    <link rel="stylesheet" href="/styles/main.css"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@48,400,1,0"/>
    <script src="/scripts/theme.js"></script>

    <link rel="icon" href="/images/favicon.ico" type="image/x-icon"/>
    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon"/>
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1><a href="/"><img src="/images/pancakes.png" alt="pancake"></a> Shayne Sivley</h1>
        <p>Welcome to PANW Cakes</p>
        <p>Cyberecurity, Automation, and Cakes</p>
        <p>The Cake is a Lie</p>
        <p class="view">
          <a href="https://github.com/greaselovely/" target="_blank"> View my Projects on GitHub <small>greaselovely</small></a>
          <a href="http://kineticlull.com/" target="_blank"> My External Dynamic List Manager <small>KineticLull</small></a>
        </p>
      </header>
      
      <!-- Main content area where individual page content will be injected -->
      <main>
        <section>
          <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">NetScreen SSG 20 Dual WAN</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2007-09-24T16:07:37-06:00" itemprop="datePublished">Sep 24, 2007
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Something I did recently using a SSG 20 with commercial T1 and Comcast and both default virtual routers. (You don’t have to use two virtual routers, but here’s why I did this at first). Initially, my client reported that Comcast was assigning DHCP to the firewall’s interface. When DHCP is used, the default route created from DHCP cannot be modifed and will show up as a directly connected route, so it will have a higher metric (unless you modify your preference / metric settings, but I have not tried that) So, if Comcast is supposed to be the backup route, placing it in the untrust-vr and controlling traffic in the trust-vr worked great. This works fine with a static IP as well.</p>

<p>Here we go:</p>

<p>Here are the default zones in the default trust-vr.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set zone "Trust" vrouter "trust-vr"
set zone "Untrust" vrouter "trust-vr"
</code></pre></div></div>

<p>I created a new custom zone and placed it in the untrust-vr</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set zone id 101 "Comcast"
set zone "Comcast" vrouter "untrust-vr"
</code></pre></div></div>

<p>I set int Ethernet0/1 in the Comcast zone. You will have to do this or track-ip will not fail the interface back. You have to setup a manage IP on the Ethernet0/0 (untrust) interface. See the the track-ip section below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set interface "ethernet0/0" zone "Untrust"
set interface "ethernet0/1" zone "Comcast"
set interface "ethernet0/2" zone "Trust"
set interface ethernet0/0 ip 1.1.1.1/24
set interface ethernet0/1 ip 2.2.2.1/24
set interface ethernet0/2 ip 192.168.1.1/24
</code></pre></div></div>

<p>I then setup the track-ip option. Track-ip will use the manage ip to ping. Why? Because if track-ip can’t ping the remote IP (usually a device a couple of hops from you) it brings down the interface (in software only) and thus can’t monitor the remote IP if the interface is down. Track-ip uses the manage ip for those tests. If the interface link goes down, whether you unplug the cable or the upstream device goes offline, then track-ip does not play a role, but since the link is down so is the first default route and thus the second default route comes up.</p>

<p><code class="language-plaintext highlighter-rouge">set interface ethernet0/0 monitor track-ip ip</code></p>

<p>The default weight is 255, which means that -this- test has to fail 255 times before the track-ip test causes the interface to go down. If you have multiple tests, the sum of all tests must equal the weight before it drops the interface and thus the route. This only happens in software, you probably will not see the link drop or the status of the interface go down.</p>

<p><code class="language-plaintext highlighter-rouge">set interface ethernet0/0 monitor track-ip weight 1</code></p>

<p>The following interval is in seconds.</p>

<p><code class="language-plaintext highlighter-rouge">set interface ethernet0/0 monitor track-ip ip 4.2.2.2 interval 5</code></p>

<p>The threshold is the number of tests that must fail before track-ip drops the interface. So, in this scenario, track-ip will monitor the remote ip every 5 seconds (interval), if it fails twice (threshold) then the weight equals 1, and brings the interface down.</p>

<p><code class="language-plaintext highlighter-rouge">set interface ethernet0/0 monitor track-ip ip 4.2.2.2 threshold 2</code></p>

<p>Set a new default route in the untrust-vr and then set route’s back to the network in the trust-vr. The default route in the untrust-vr will be active but traffic won’t hit this VR until the track-ip option disables the interface located in the trust-vr. When that happens, the default route in the trust-vr becomes inactive and the second route comes up, sending traffic to the untrust-vr. Note the preference on the two default routes in the trust-vr.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set vrouter "untrust-vr"
set route 0.0.0.0/0 interface ethernet0/1 gateway 2.2.2.2
set route 192.168.1.0/24 vrouter "trust-vr" preference 20
exit
set vrouter "trust-vr"
unset add-default-route
set route 0.0.0.0/0 interface ethernet0/0 gateway 1.1.1.2 preference 10
set route 0.0.0.0/0 vrouter "untrust-vr" preference 20 metric 1
exit
</code></pre></div></div>

<hr />

<p>Other Posts You May Want To Cover in Syrup:</p>

  </div><a class="u-url" href="/juniper/netscreen/2007/09/24/juniper-netscreen-dual-wan.html" hidden></a>
</article>

          <ul class="posts">
            
              <li>
                <!-- <span class="post-date">2009-07-08</span><br> -->
                <a href="/microsoft/windows/2009/07/08/windows-home-dir-gone-wild.html">Home Directories Gone Wild</a>
              </li>
            
              <li>
                <!-- <span class="post-date">2009-05-05</span><br> -->
                <a href="/juniper/netscreen/2009/05/05/screenos-oids-for-cpu-and-sessions.html">ScreenOS OIDs for CPU and Sessions</a>
              </li>
            
              <li>
                <!-- <span class="post-date">2008-06-19</span><br> -->
                <a href="/random/2008/06/19/devaluation-of-technical-certifications-in-progress.html">Devaluation of Technical Certifications In Progress</a>
              </li>
            
              <li>
                <!-- <span class="post-date">2008-02-26</span><br> -->
                <a href="/switch/2008/02/26/entry-level-switch-throughput-comparison.html">Entry Level Switch Throughput Comparison</a>
              </li>
            
              <li>
                <!-- <span class="post-date">2007-11-13</span><br> -->
                <a href="/blog/2007/11/13/t1-utilization-questions.html">T1 Utilization Questions...</a>
              </li>
            
              <li>
                <!-- <span class="post-date">2007-11-08</span><br> -->
                <a href="/crisco/2007/11/08/cisco-catalyst-5509-coffee-table.html">Cisco Catalyst 5509 Coffee Table</a>
              </li>
            
              <li>
                <!-- <span class="post-date">2007-09-24</span><br> -->
                <a href="/juniper/netscreen/2007/09/24/juniper-netscreen-dual-wan.html">NetScreen SSG 20 Dual WAN</a>
              </li>
            
              <li>
                <!-- <span class="post-date">2007-09-23</span><br> -->
                <a href="/smtp/email/2007/09/23/um-ehlo.html">Um, EHLO?!</a>
              </li>
            
          </ul>
        </section>
      </main>
      <footer>
        <p>
          <button class="material-symbols-sharp" id="theme-toggle" title="Toggle dark mode" onclick="toggleDarkMode()"></button>
        </p>
      </footer>
    </div>
    
    <script src="/scripts/scale.fix.js"></script>
  </body>
</html>
